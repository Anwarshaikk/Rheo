rules_version = '2';
service cloud.firestore {
  match /databases/{db}/documents {
    function inOrg(orgId) { return request.auth != null && request.auth.token.orgs[orgId] == true; }

    match /orgs/{orgId} {
      allow read, write: if inOrg(orgId);
    }
    match /{colName}/{docId} {
      allow read, write: if request.auth != null &&
        (resource.data.orgId in request.auth.token.orgs || request.resource.data.orgId in request.auth.token.orgs);
    }
  }
}
